services:
  fitbit-ui-enhanced:
    build: .
    image: fitbit-wellness-enhanced:latest  # Your custom image name
    container_name: fitbit-report-app-enhanced
    ports:
      - "5032:5032"  # OAuth callback port
      - "5033:5033"  # Main dashboard port
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "50m"     # Max size per log file
        max-file: "3"       # Keep 3 rotated files (150MB total)
    environment:
      - CLIENT_ID=${CLIENT_ID}
      - CLIENT_SECRET=${CLIENT_SECRET}
      - REDIRECT_URL=${REDIRECT_URL:-http://192.168.13.5:5032/}
      - DASHBOARD_PASSWORD=${DASHBOARD_PASSWORD:-}
      - API_KEY=${API_KEY:-}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      # Log Level Options:
      # - CRITICAL/FATAL: Only fatal errors that crash the app (least verbose)
      # - ERROR: Serious errors that don't crash the app
      # - WARN/WARNING: Potential issues, fallback settings, deprecation warnings
      # - INFO: Normal operational messages (DEFAULT - recommended for production)
      # - DEBUG: Detailed diagnostic info for troubleshooting (verbose)
      # - TRACE: Step-by-step execution details (most verbose - includes all [CACHE_DEBUG] messages)
    volumes:
      # Persist cache database and logs across container rebuilds
      # Note: Mount parent directory, not the file directly (Docker creates directories for non-existent files)
      - ./data:/app/data
      - ./logs:/app/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5033/api/health"]
      interval: 60s
      timeout: 10s
      retries: 5
      start_period: 120s
